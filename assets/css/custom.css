@layer base {
  /* Keyframes */

  @keyframes typing {
    from {
      width: 0;
    }
    to {
      width: var(--typing-length);
    }
  }

  @keyframes blink-cursor {
    0%,
    50% {
      border-right-color: var(--color-primary);
    }
    51%,
    100% {
      border-right-color: transparent;
    }
  }

  @keyframes dot-bounce {
    0% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-8px);
    }
    100% {
      transform: translateY(0);
    }
  }

  @keyframes glitch {
    0%,
    90% {
      transform: translate(0);
      filter: hue-rotate(0deg);
      text-shadow: none;
    }

    91% {
      transform: translate(-2px, 1px);
      filter: hue-rotate(90deg);
      text-shadow:
        2px 0 var(--color-red-500),
        -2px 0 var(--color-cyan-500),
        0 0 8px var(--color-primary);
    }

    92% {
      transform: translate(2px, -1px);
      filter: hue-rotate(180deg);
      text-shadow:
        -1px 0 var(--color-green-500),
        1px 0 var(--color-magenta-500),
        0 0 12px var(--color-secondary);
    }

    93% {
      transform: translate(-1px, 2px) scale(1.01, 0.99);
      filter: hue-rotate(270deg) contrast(1.2);
      text-shadow:
        3px 0 var(--color-blue-500),
        -3px 0 var(--color-yellow-500);
    }

    94% {
      transform: translate(1px, -2px) scale(0.99, 1.01);
      filter: hue-rotate(45deg) saturate(1.5);
      text-shadow:
        0 2px var(--color-purple-500),
        0 -2px var(--color-orange-500);
    }

    95% {
      transform: translate(-3px, 0) skew(2deg);
      filter: hue-rotate(135deg) brightness(1.2);
      text-shadow:
        1px 1px var(--color-pink-500),
        -1px -1px var(--color-teal-500);
    }

    96%,
    100% {
      transform: translate(0);
      filter: hue-rotate(0deg);
      text-shadow: none;
    }
  }

  /* Images */

  .image {
    background-color: var(--color-surface-20);

    &[data-error='true'] {
      object-fit: contain;
      background: var(--color-surface-20) url('/images/icons/image-off.svg') center;
      background-repeat: no-repeat;
      background-size: 20%;
      filter: opacity(0.6);
    }
  }

  /* Tooltip */

  .tooltip-container {
    --tooltip-offset: var(--tooltip-gap);
    --tooltip-arrow-size: 10px;
    --tooltip-border-width: 1px;
  }

  .tooltip {
    width: fit-content;
    max-width: var(--tooltip-max-width, 300px);
    position-area: var(--tooltip-position, top);
    position-try-fallbacks: flip-block;
    white-space: nowrap;
    overflow: visible;

    opacity: 0;
    transition:
      opacity 0.2s,
      display 0.2s allow-discrete;

    &:popover-open {
      opacity: 1;

      @starting-style {
        & {
          opacity: 0;
        }
      }
    }

    &[data-show-arrow] {
      --tooltip-offset: calc(
        var(--tooltip-gap) + (var(--tooltip-arrow-size) * 0.25) + var(--tooltip-border-width)
      );
    }

    &[data-tooltip-area='block'] {
      margin-block: var(--tooltip-offset);
      margin-inline: 0;
    }

    &[data-tooltip-area='inline'] {
      margin-block: var(--tooltip-offset);
      margin-inline: 0;
    }

    &[data-multiline] {
      white-space: normal;
    }
  }

  /* Tooltip Arrow */

  /* bottom: calc(-1 * (var(--tooltip-arrow-size) / 2 + var(--tooltip-border-width))); */
  /* bottom: calc(anchor(start) + 10px); */
  .tooltip::before {
    content: '';
    /* width: var(--tooltip-arrow-size); */
    /* height: var(--tooltip-arrow-size); */
    position: absolute;
    inset: 0;

    /* left: calc(anchor(right) + 10px); */
    /* bottom: calc(anchor(start) + 10px); */
    background-color: olive;

    /* background: inherit; */
    /* border-color: inherit; */
    /* border-style: solid; */
    /* transform: rotate(45deg); */
    /* z-index: -1; */
  }

  /* Navbar */

  .navbar {
    --nav-px: 0.725rem;

    display: flex;
    width: fit-content;

    &::before {
      content: '';
      position: absolute;
      position-anchor: --nav-link;
      top: auto;
      left: calc(anchor(left) + var(--nav-px));
      right: calc(anchor(right) + var(--nav-px));
      bottom: anchor(bottom);
      height: 2px;
      background: var(--color-content-40);
      opacity: 0.8;
      transition: 500ms
        linear(
          0,
          0.029 1.6%,
          0.123 3.5%,
          0.651 10.6%,
          0.862 14.1%,
          1.002 17.7%,
          1.046 19.6%,
          1.074 21.6%,
          1.087 23.9%,
          1.086 26.6%,
          1.014 38.5%,
          0.994 46.3%,
          1
        );
    }

    /* Show indicator under current page if no link is hovered */
    &:not(:has(.navbar-link:is(:hover, :focus-visible))) .navbar-link[aria-current] {
      anchor-name: --nav-link;
    }

    /* When hovering any link, that link becomes the anchor */
    .navbar-link:is(:hover, :focus-visible) {
      anchor-name: --nav-link;
    }

    /* Highlight current page indicator if no link is hovered */
    &:has(.navbar-link[aria-current]):not(:has(.navbar-link:is(:hover, :focus-visible)))::before {
      background: var(--color-primary);
      opacity: 1;
    }

    /* Fallback for browsers that don't support position-anchor */
    @supports not (position-anchor: --nav-link) {
      &::before {
        display: none;
      }
    }
  }

  .navbar-link {
    position: relative;
    display: block;
    padding: 0.25rem var(--nav-px);
    font-size: 15px;
    color: var(--color-content-40);
    cursor: pointer;
    outline: none;
    border-radius: 999px;
    transition: color 200ms;

    @supports (corner-shape: squircle) {
      corner-shape: squircle;
    }

    &:focus-visible {
      outline: 1px dashed var(--color-primary);
      outline-offset: 2px;
    }

    /* Only apply anchor-name on hover/focus */
    &:is(:hover, :focus-visible) {
      color: var(--color-content-10);
    }

    &[aria-current] {
      font-weight: var(--font-weight-medium);
      color: var(--color-content-10);
    }

    @supports not (position-anchor: --nav-link) {
      &::after {
        content: '';
        position: absolute;
        inset: 0;
        top: auto;
        bottom: 0px;
        left: 25%;
        width: 50%;
        height: 2px;
        background: transparent;
        border-radius: 1px;
        transition: background 200ms ease;
      }

      &:hover::after,
      &:focus-visible::after {
        background: var(--color-content-40);
      }

      &[aria-current]::after {
        background: var(--color-primary);
      }
    }
  }

  .typing-reveal {
    --typing-length: 9.5ch;
    --typing-steps: 7;

    width: 0;
    display: none;
    position: relative;
    font-family: var(--font-mono);
    overflow: hidden;
    white-space: nowrap;
    opacity: 0;
    border-right: 2px solid transparent;
  }

  .group:hover .typing-reveal {
    display: block;
    animation:
      typing 0.8s steps(var(--typing-steps), end) forwards,
      fade-in 0.1s ease-in forwards,
      blink-cursor 1s step-end infinite 0.8s;
    width: var(--typing-length);
    opacity: 1;
    border-right-color: var(--color-primary);
  }

  .profile-picture {
    position: relative;
    width: fit-content;
    height: fit-content;

    /* Backdrop */
    &::before {
      content: '';
      position: absolute;
      inset: -0.325rem;
      border: 0.1rem solid --alpha(var(--color-content-40) / 0.4);
      border-radius: 100%;
      background: repeating-linear-gradient(
        45deg,
        --alpha(var(--color-content-40) / 0.3),
        --alpha(var(--color-content-40) / 0.35) 0.1rem,
        transparent 0,
        transparent 0.725rem
      );
      z-index: -1;
    }

    /* Progress ring */
    &::after {
      content: '';
      position: absolute;
      inset: -0.325rem;
      border-radius: 100%;
      box-shadow: var(--shadow-lg);
      background: conic-gradient(
        --alpha(var(--color-primary) / 0.9) var(--progress, 0%),
        transparent var(--progress, 0%)
      );
      mask: radial-gradient(
        farthest-side,
        transparent calc(100% - 0.165rem),
        #000 calc(100% - 0.2rem)
      );
      opacity: 1;
      z-index: -1;
      transition: opacity 0.3s ease;
    }

    & .slideshow-container {
      position: relative;
      max-width: 280px;
      aspect-ratio: 1/1;
      border-radius: 100%;
      overflow: hidden;
    }

    & .slideshow-container > .slide {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      border-radius: 100%;
      transition: opacity 1000ms ease;
    }

    & .slideshow-container > .slide[data-active] {
      opacity: 1;
      z-index: 1;
    }

    & .slideshow-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 100%;
      box-shadow: var(--shadow-lg);
    }

    /* Navigation buttons */
    & .slideshow-nav-prev,
    & .slideshow-nav-next {
      position: absolute;
      top: 50%;
      width: 2.25rem;
      height: 2.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-content-30);
      background-color: --alpha(var(--color-surface-10) / 0.7);
      border: 1px solid var(--color-surface-10);
      border-radius: 50%;
      box-shadow: var(--shadow-sm);
      backdrop-filter: blur(4px);
      transform: translateY(-50%);
      transition: all 0.2s ease;
      cursor: pointer;
      z-index: 10;
      opacity: 0;

      &:hover {
        color: var(--color-content-10);
        border-color: var(--color-secondary);
        box-shadow: var(--shadow-md);
        transform: translateY(-50%) scale(1.05);
      }

      &:active {
        transform: translateY(-50%) scale(0.95);
      }
    }

    & .slideshow-nav-prev {
      left: 0.5rem;
    }

    & .slideshow-nav-next {
      right: 0.5rem;
    }

    &:hover .slideshow-nav-prev,
    &:hover .slideshow-nav-next {
      opacity: 1;
    }

    & .slideshow-nav-prev:focus-visible,
    & .slideshow-nav-next:focus-visible {
      outline: 2px solid var(--color-primary);
      opacity: 1;
    }

    &:hover::after {
      opacity: 0;
    }
  }

  .dot-jump {
    @media (prefers-reduced-motion: no-preference) {
      animation: dot-bounce 0.4s ease-out;
    }
  }

  /* Travel */

  .travel-map {
    position: relative;
    width: 100%;
    height: clamp(250px, 40vh, 300px);
    margin: 0 auto;
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-surface-20);
    background-color: var(--color-surface);
    box-shadow: var(--shadow-xs);
    z-index: 1;

    &::after {
      content: '';
      position: absolute;
      inset: 0;
      background-color: --alpha(var(--color-surface-20) / 0.5);
      z-index: -1;
    }

    @variant md {
      height: clamp(300px, 40vh, 400px);
    }

    @variant 2xl {
      height: clamp(350px, 50vh, 500px);
    }
  }

  .travel-map svg {
    width: 100%;
    height: 100%;
    border-radius: var(--radius-lg);
  }

  .travel-map .map-pin {
    transition:
      fill 0.3s,
      r 0.3s;
    cursor: pointer;
  }

  .travel-map .country {
    fill: var(--color-surface-30);
    transition: fill 0.2s ease;

    &.visited {
      stroke: var(--color-amber-300);
      fill: --alpha(var(--color-amber-100) / 90%);

      @variant dark {
        stroke: var(--color-amber-400);
        fill: var(--color-amber-200);
      }
    }
  }

  /* Pin Tooltip */
  .travel-map .map-tooltip {
    padding: 0.5rem 0.75rem;
    font-size: var(--text-sm);
    line-height: var(--leading-tight);
    background-color: --alpha(var(--color-slate-900) / 0.92);
    color: var(--color-slate-50);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    backdrop-filter: blur(4px);
    white-space: nowrap;
    z-index: 10;
  }

  .travel-map .map-tooltip .tooltip-title {
    font-weight: var(--font-weight-medium);
    color: var(--color-primary);
  }

  .travel-map .map-tooltip .tooltip-subtitle {
    color: var(--color-slate-100);
  }

  .travel-map .map-tooltip .tooltip-info {
    color: var(--color-slate-300);
  }

  /* Resume Summary */

  #resume-summary {
    & strong {
      text-decoration: underline;
      text-decoration-color: var(--color-surface-40);
    }
  }

  /* Music Player */
  /* Based on https://samuelkraft.com/blog/animated-music-bars */
  .now-playing-icon {
    --playing-color: var(--color-emerald-500);

    height: 13px;
    width: 13px;
    position: relative;
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
  }

  .now-playing-icon > span {
    height: 100%;
    width: 3px;
    background-color: var(--playing-color);
    border-radius: 3px;
    transform-origin: bottom;
    animation: spectrum 2.2s ease infinite alternate;
  }

  .now-playing-icon > span:nth-of-type(2) {
    animation-delay: -2.2s;
  }

  .now-playing-icon > span:nth-of-type(3) {
    animation-delay: -3.7s;
  }

  @keyframes spectrum {
    10% {
      transform: scaleY(0.3);
    }

    30% {
      transform: scaleY(1);
    }

    60% {
      transform: scaleY(0.5);
    }

    80% {
      transform: scaleY(0.75);
    }

    100% {
      transform: scaleY(0.6);
    }
  }

  /* Home Theme Switcher */
  .theme-switcher {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    cursor: pointer;
    color: var(--color-content-40);
    outline: none;

    svg {
      width: 2.5em;
      height: 2.5em;
      opacity: 0.25;
      transition: opacity 0.3s ease;
    }

    &:hover svg {
      opacity: 0.5;
    }

    #theme-switcher-sun,
    #theme-switcher-rays,
    #theme-switcher-moon {
      transition:
        transform 500ms ease-in-out,
        opacity 250ms ease;
      transform-origin: center;
    }

    #theme-switcher-sun {
      opacity: 1;
    }

    #theme-switcher-rays {
      opacity: 1;
      transform: scale(1);
    }

    #theme-switcher-moon {
      opacity: 0;
      transform: scale(0.25);
      transform: rotate(180deg);
    }

    @variant dark {
      #theme-switcher-sun {
        opacity: 0;
      }

      #theme-switcher-rays {
        opacity: 0;
        transform: scale(0.25);
      }

      #theme-switcher-moon {
        opacity: 1;
        transform: scale(1);
        transform: rotate(0deg);
      }
    }

    .theme-switcher-led {
      width: 28px;
      height: 4px;
      background-color: var(--color-teal-500);
      border-radius: var(--radius-sm);
      box-shadow: inset 0 0 2px var(--color-teal-900);
      transition: background-color 0.5s ease;

      @variant dark {
        background-color: var(--color-primary);
        box-shadow: inset 0 0 2px var(--color-red-950);
      }
    }
  }
}
